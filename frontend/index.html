<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Movie Genre Recommender</title>
    <style>
        body { max-width: 600px; margin: 2rem auto; font-family: Arial, sans-serif; }
        textarea { width: 100%; height: 100px; }
        button { margin-top: 1rem; padding: 10px 20px; background: #6200ea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        #result { margin-top: 1rem; white-space: pre-wrap; }
        .movie-card { border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Movie Genre Recommender</h1>
    <p>Describe what kind of movie you'd like to watch:</p>
    <textarea id="overview" placeholder="Example: I want a scary horror movie with some comedy elements..."></textarea>
    <button onclick="getGenres()">Get Recommendations</button>
    <div id="result"></div>

    <script>
        async function getGenres() {
            const overview = document.getElementById('overview').value.trim();
            if (!overview) {
                alert('Please enter a description of the movie you want!');
                return;
            }
            
            document.getElementById('result').innerHTML = '<p>Loading recommendations...</p>';

            try {
                // Use relative path for local development
                const apiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
                    ? '/predict/' 
                    : '/predict/';
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ overview })
                });

                if (!response.ok) throw new Error('API error: ' + response.status);

                const data = await response.json();
                let html = `<h2>Recommended for you:</h2>`;
                
                if (!data.predicted_genres || data.predicted_genres.length === 0) {
                    html += `<p>No specific genres predicted. Try being more specific.</p>`;
                } else {
                    html += `<p><strong>Predicted genres:</strong> ${data.predicted_genres.join(', ')}</p>`;
                }

                if (data.recommendations && data.recommendations.length > 0) {
                    data.recommendations.forEach((rec, i) => {
                        html += `
                        <div class="movie-card">
                            <h3>Recommendation ${i+1}</h3>
                            <p>${rec.overview}</p>
                            <p><em>Genres: ${rec.genres.join(', ')}</em></p>
                        </div>`;
                    });
                } else {
                    html += `<p>No specific recommendations found. Try a different description.</p>`;
                }
                
                document.getElementById('result').innerHTML = html;
            } catch (e) {
                document.getElementById('result').innerHTML = `<p style="color: red;">Error: ${e.message}</p>`;
                console.error(e);
            }
        }
    </script>
</body>
</html>
